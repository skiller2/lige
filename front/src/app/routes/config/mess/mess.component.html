<nz-card class="small-margin">
  <button nz-popconfirm nzType="primary" class="btn-add" nz-button (click)="getMessInfo()">
    Obtener estado mess
  </button>
  <p>{{ messInfo() | json }}</p>

  <h3>Parametros ChatBot WhatsApp</h3>
  <h4>Tiempo entre mensajes</h4>
  <input #inputElement style="width: 120px" nz-input nz-tooltip nzOverlayClassName="numeric-input"
    (ngModelChange)="msChange($event)" [ngModel]="ms()" placeholder="Input a number" />
  <button nz-popconfirm nzType="primary" class="btn-add" nz-button (click)="setMs()">
    Cambiar
  </button>
  <br>
  <img [src]="imagenUrl()" alt="QR">

</nz-card>

<nz-card>
  <h4>Conversación</h4>
      <nz-form-label [nzSpan]="5">Persona</nz-form-label>

      <nz-form-control [nzSpan]="19">
        <app-personal-search 
          (ngModelChange)="changePersona($event)" ngModel [anio]="0"
          [mes]="0" />
      </nz-form-control>

    <nz-form-label [nzSpan]="6" nzFor="chatId">Teléfono</nz-form-label>
    <nz-form-control [nzSpan]="14">
      <input nz-input name="chatId" type="text" id="chatId" [(ngModel)]="chatId" />
    </nz-form-control>

  <nz-card style="min-height: 300px;">

    <div class="chat-messages">
      <div *ngFor="let msg of msgs(); trackBy: trackByMsgId" class="chat-line" [ngClass]="msg.tool_calls ? 'tool-call' : msg.role">
        
        @if (showTools() || (msg.role !== 'tool' && !msg.tool_calls)) {

        <nz-card nzSize="small">
          {{ msg.content || (msg.tool_calls |json) }}
        </nz-card>
        }
      </div>
    </div>

  </nz-card>



  <input style="width: 300px" nz-input nz-tooltip [(ngModel)]="usermsg" />
  <button nz-popconfirm nzType="primary" class="btn-add" nz-button (click)="enviaChat($event)">Enviar</button>
  <button nz-popconfirm nzType="primary" class="btn-add" nz-button (click)="reiniciaChat()">Reiniciar</button>

  <label style="display:inline-flex; gap:8px; align-items:center; margin-left: 12px;">
    <input type="checkbox" [checked]="showTools()" (change)="toggleShowTools($event)" />
    Mostrar uso de herramientas
  </label>

</nz-card>

<!--
<nz-card class="small-margin">

  <h4>Celular</h4>
  <input
        style="width: 120px"
        nz-input
        nz-tooltip
        nzOverlayClassName="numeric-input"
        [(ngModel)]="destino"
        placeholder="Input a number"
    />

    <h4>Mensaje</h4>
    <textarea
          [(ngModel)]="mensaje"
          placeholder="mensaje"
      ></textarea>
  

  <button nz-popconfirm nzType="primary" class="btn-add" nz-button (click)="enviaMensaje()">Enviar</button>
  
</nz-card>
-->