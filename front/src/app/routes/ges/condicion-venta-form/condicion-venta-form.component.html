<form [formGroup]="formCondicionVenta">
  <br>

  <nz-form-item class="marginElement" style="display:none">
    <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="6">codobjId</nz-form-label>
    <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="16">
      <input nz-input placeholder="" formControlName="codobjId" type="string" />
    </nz-form-control>
  </nz-form-item>

  <nz-form-item class="marginElement">
    <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="6">Objetivo</nz-form-label>
    <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="16">
      <app-objetivo-search formControlName="ObjetivoId"
        (valueExtendedChange)="objetivoDetalleChange($event)"></app-objetivo-search>
    </nz-form-control>
  </nz-form-item>


  <nz-form-item class="marginElement">
    <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="6">Aplica Desde</nz-form-label>
    <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="8">
      <nz-date-picker formControlName="PeriodoDesdeAplica" nzMode="month" nzFormat="MM/yyyy" style="width: 100%;">
      </nz-date-picker>

    </nz-form-control>
  </nz-form-item>

  <nz-form-item class="marginElement">
    <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="6">Periodo de Facturación</nz-form-label>
    <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="16">
      <input nz-input formControlName="PeriodoFacturacion" placeholder="Ej: '1S' ,'1M', '1A'." style="width: 100%;" />
    </nz-form-control>
  </nz-form-item>

  <nz-form-item class="marginElement">
    <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="6">Día de Generación Factura</nz-form-label>
    <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="8">
      <input nz-input nzInputNumber formControlName="GeneracionFacturaDia" min="1" max="31" step="1"
        placeholder="Día del mes (1-31)" style="width: 100%;">
    </nz-form-control>
  </nz-form-item>

  <nz-form-item class="marginElement">
    <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="6">Día de Generación Factura (Complemento)</nz-form-label>
    <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="11">
      <input nz-input nzInputNumber formControlName="GeneracionFacturaDiaComplemento" min="1" max="31" step="1"
        placeholder="Día complemento" style="width: 100%;">
    </nz-form-control>
  </nz-form-item>

  <nz-form-item class="marginElement">
    <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="6">Observaciones</nz-form-label>
    <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="16">
      <textarea nz-input formControlName="Observaciones" placeholder="Ingrese observaciones"
        [nzAutosize]="{ minRows: 3, maxRows: 6 }">
      </textarea>
    </nz-form-control>
  </nz-form-item>


  <div class="input-container">
    <div class="input-label">Productos</div>
  </div>
  <div formArrayName="infoProductos" style="padding-top: 25px;">
    @for (control of infoProductos().controls; track control; let i = $index) {
    <div [formGroupName]="i" [ngClass]="{'even-background': i % 2 === 0}" [style.margin-top.px]="i % 2 !== 0 ? 15 : 0">

      <nz-form-item class="marginElement">
        <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="3"> Producto</nz-form-label>
        <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="3" [nzLg]="5">
          <nz-select nzAllowClear style="width:100%" nzPlaceholder="Producto" formControlName="ProductoCodigo"
            nzShowSearch [nzDropdownMatchSelectWidth]="false">
            @for (option of $optionsTipoProducto | async; track option) {
            <nz-option [nzValue]="option.ProductoCodigo" [nzLabel]="option.Nombre"></nz-option>
            }
          </nz-select>
        </nz-form-control>

        <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="2">Metodología</nz-form-label>
        <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="3" [nzLg]="5">
          <nz-select formControlName="Metodologia" style="width: 100%" nzPlaceholder="Seleccione" nzAllowClear
            [nzDropdownMatchSelectWidth]="false" (ngModelChange)="MetodologiaSelected.set($event)">
            @for (option of $optionsMetodologia | async; track option) {
            <nz-option [nzValue]="option.value" [nzLabel]="option.label"></nz-option>
            }

          </nz-select>
        </nz-form-control>

      </nz-form-item>



      <nz-form-item class="marginElement">
        @if (control?.value.Metodologia === 'A') {
        <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="3">Cantidad</nz-form-label>
        <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="3" [nzLg]="3">
          <input appDotToComma mask="separator.2" nz-input nzInputNumber formControlName="Cantidad" type="text"
            style="width: 100%;" placeholder="Cantidad" (ngModelChange)="calcularTotal(i)">
        </nz-form-control>
        } @else if (control?.value.Metodologia === 'B' || control?.value.Metodologia === 'C') {
        <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="3">Horas a facturar</nz-form-label>
        <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="3" [nzLg]="3">
          <nz-select formControlName="IndHorasAFacturar" style="width: 100%" nzPlaceholder="Seleccione" nzAllowClear
            [nzDropdownMatchSelectWidth]="false">
            <nz-option [nzValue]="'A'" nzLabel="Horas A"></nz-option>
            <nz-option [nzValue]="'B'" nzLabel="Horas B"></nz-option>
          </nz-select>
        </nz-form-control>
        } @else {
          <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="3">...</nz-form-label>
        <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="3" [nzLg]="3">
          <input nz-input formControlName="default" type="text"
            style="width: 100%;" placeholder="...">
        </nz-form-control>
        <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="3">...</nz-form-label>
        <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="3" [nzLg]="3">
          <input nz-input formControlName="default" type="text"
            style="width: 100%;" placeholder="...">
        </nz-form-control>
        }

        @if (control?.value.Metodologia === 'A'){
        <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="2">Importe Unitario</nz-form-label>
        <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="3" [nzLg]="4">
          <input appDotToComma mask="separator.2" nz-input nzInputNumber style="width: 100%"
            formControlName="ImporteUnitario" type="text" min="0" step="0.01" placeholder="Importe Unitario"
            (ngModelChange)="calcularTotal(i)">
        </nz-form-control>

        <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="2">Importe Total</nz-form-label>
        <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="3" [nzLg]="4">
          <input appDotToComma mask="separator.2" nz-input placeholder="" formControlName="ImporteTotal" type="text"
            class="text-right" />
        </nz-form-control>

      }@else if (control?.value.Metodologia === 'B'){
        <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="2">Importe Unitario</nz-form-label>
        <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="3" [nzLg]="4">
          <input appDotToComma mask="separator.2" nz-input nzInputNumber style="width: 100%"
            formControlName="ImporteUnitario" type="text" min="0" step="0.01" placeholder="Importe Unitario"
            (ngModelChange)="calcularTotal(i)">
        </nz-form-control>

      }
      </nz-form-item>

      <nz-form-item class="marginElement">

        <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="3">Texto Factura</nz-form-label>
        <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="3" [nzLg]="16">
          <textarea nz-input formControlName="TextoFactura" rows="3" style="width: 100%;"
            nzPlaceholder="Ingrese el texto de la factura"></textarea>
        </nz-form-control>

        @if (formCondicionVenta.enabled) {
        <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="2" class="button-group-direction">
          <div class="button-group" style="width: 100%">
            @if (infoProductos().controls.length == i+1) {
            <button nz-button class="add-button" nzType="primary" class="add-button"
              (click)="addProductos($event)" nz-tooltip nzTooltipTitle="{{ 'app.icon.add' | i18n }}">
              <span nz-icon nzType="plus"></span>
            </button>
            }
            @if (infoProductos().length >= 2) {
            <button nz-button nzType="default" (click)="removeProductos(i, $event)" nz-tooltip
              nzTooltipTitle="{{ 'app.icon.delete' | i18n }}">
              <span nz-icon nzType="delete" nzTheme="outline"></span>
            </button>
            }
          </div>
        </nz-form-control>
        }

      </nz-form-item>
    </div>
    }
  </div>

  @if (formCondicionVenta.enabled) {
  <nz-form-item class="btn-margintop">
    <nz-form-control style="display: flex; justify-content: center; align-items: center; gap: 8px;">
      <button style="margin-right: 10px;" nzType="primary" nz-button (click)="save()"
        [disabled]="formCondicionVenta.invalid || formCondicionVenta.pristine">
        {{ 'app.btn.save' | i18n }}
      </button>
      <button nz-button nzType="default" (click)="clearForm()">
        {{ 'app.btn.clear' | i18n }}
      </button>
    </nz-form-control>
  </nz-form-item>

  }

</form>