<page-header />
<nz-card>
  <form nz-form #impuestoForm="ngForm">
    <ng-container *ngIf="{ lista: (listaDescuentos$ | async) } as context">
      <nz-date-picker
        nzMode="month"
        name="periodo"
        ngModel
        (ngModelChange)="onChange($event)" />
      <nz-tabset nzCentered>
        <nz-tab nzTitle="Cargar Comprobantes">
          <div
            *ngIf="context.lista?.RegistrosSinComprobantes && 1"
            nz-col
            nzXs="24"
            nzSm="12"
            nzMd="6"
            class="mb-md">
            <div
              nz-row
              nzType="flex"
              nzAlign="middle"
              class="ant-btn-danger rounded-md">
              <div nz-col nzSpan="24" class="p-md text-white">
                <div class="h2 mt0">
                  Pendientes: {{ context.lista?.RegistrosSinComprobantes }}
                </div>
                <p class="text-nowrap mb0">
                  Cargados: {{ context.lista?.RegistrosConComprobantes }}
                </p>
              </div>
            </div>
          </div>

          <nz-upload
            class="d-block"
            nzType="drag"
            [nzMultiple]="true"
            [nzData]="{ anio: anio, mes: mes }"
            (nzChange)="handleChange($event)"
            [nzAction]="url"
            nzName="pdf"
            [(nzFileList)]="files"
            nzAccept="application/pdf">
            <p class="ant-upload-drag-icon">
              <span nz-icon nzType="inbox"></span>
            </p>
            <p class="ant-upload-text">
              Clickeá or arrastrá archivos para cargar
            </p>
          </nz-upload>
        </nz-tab>
        <nz-tab nzTitle="Monotributo">
          <div nz-row nzJustify="space-around">
            <div nz-col [nzSpan]="13" style="text-align: center">
              <label>Persona Responsable:</label>
              <app-personal-search
                (ngModelChange)="formChanged($event)"
                [(ngModel)]="selectedPersonalId"
                [ngModelOptions]="{ standalone: true }" />
            </div>
            <div nz-col [nzSpan]="9" style="text-align: center">
              <button
                nz-button
                down-file
                class="mr-sm"
                http-url="api/impuestos_afip/download/{{ anio }}/{{ mes }}/{{
                  selectedPersonalId
                }}">
                <span nz-icon nzType="download"
                  >Descarga masiva de comprobantes</span
                >
              </button>

              <button nz-button (click)="downloadMultipleAction$.next('')">
                <span nz-icon nzType="download"
                  >Descarga masiva de comprobantes</span
                >
              </button>
            </div>
          </div>
          <!--  Se rompe leyendo [data]
-->
          <button nz-button (click)="st.export()">Export</button>
          <button nz-button (click)="st.export(true)">
            Export Filtered Data
          </button>
          <button
            nz-button
            (click)="
              st.export(context.lista?.Registros || [], {
                filename: 'via-data.xlsx',
                sheetname: 'user'
              })
            ">
            Export via data
          </button>

          <st
            #st
            [data]="'/api/impuestos_afip/list'"
            [res]="{ reName: { total: 'data.total', list: 'data.list' } }"
            [req]="{ params: filters, method: 'POST', allInBody: true }"
            [columns]="columns2"
            class="mt-sm"
            [widthMode]="{ type: 'strict' }"
            resizable></st>

          <!-- <nz-table
            class="app-table"
            #tablaDescuentos
            [nzData]="context.lista?.Registros || []"
            nzSize="small"
            [nzLoading]="tableLoading$ | async"
            [nzPageSize]="100000000"
            [nzShowPagination]="false">
            <thead>
              <tr>
                <th
                  *ngFor="let column of listOfColumns"
                  [(nzSortOrder)]="column.sortOrder"
                  [nzSortFn]="column.sortFn"
                  [nzFilters]="column.listOfFilter"
                  [nzFilterFn]="column.filterFn">
                  {{ column.name }}
                </th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of tablaDescuentos.data">
                <td>{{ data.CUIT }}</td>
                <td>
                  {{ data.ApellidoNombre }}
                  <button
                    nz-button
                    *ngIf="data.PersonalOtroDescuentoDescuentoId"
                    (click)="downloadAction$.next(data)">
                    <span nz-icon nzType="download"></span>
                  </button>
                </td>
                <td>{{ data.PersonalEstado }}</td>
                <td>{{ data.monto | currency }}</td>
                <td>{{ data.CUITJ }}</td>
                <td>{{ data.ApellidoNombreJ }}</td>
              </tr>
            </tbody>
          </nz-table> -->
        </nz-tab>
      </nz-tabset>
    </ng-container>
  </form>
</nz-card>
